name: React Examples Workflow

on:
  push:
    branches: [ $default-branch, real-time_text_component ]
  pull_request:
    branches: [ $default-branch ]

jobs:
  tests:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v2
          
      - name: Install Composer
        run: php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
         php -r "if (hash_file('sha384', 'composer-setup.php') === '756890a4488ce9024fc62c56153228907f1545c228516cbf63f885e036d37e9a59d27d63f46af1d4d07ee0f76181c7d3') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;"
         php composer-setup.php
         php -r "unlink('composer-setup.php');"
      - name: Check Composer version
        run: composer -V
      - name: Install Phpunit
        run: composer require --dev phpunit/phpunit ^9
      - name: Connect to mySQL
        run: cp .env.example .env
        env: 
          DB_HOST: 127.0.0.1
          DB_PORT: 3306
          DB_DATABASE: tutorial
          DB_USERNAME: root
          DB_PASSWORD: 
      - name: Setup database
        run: mysqlsh
      - name: Run migrations
        run: php artisan migrate
      - name: Run tests
        run: ./vendor/bin/phpunit tests
